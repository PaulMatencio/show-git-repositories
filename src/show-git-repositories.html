<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="icon-toggle.html">
<link rel="import" href="shared-styles.html">

<dom-module id="show-git-repositories">
    <template>
        <!-- Styles MUST be inside template -->
      <style include="shared-styles">
        :host {
            display: block;
            padding : 10px;
        }

        .bold  {
            font-size: 20px;
            font-weight: bold;
            color: grey;
            margin-bottom: 0 0 30px 0;
            display: block;
        }

        input[type=text] {
          width: 40%;
          padding: 12px 15px;
          margin: 8px 0;
          font-size: 24px;
          box-sizing: border-box;
          border-width: 3px;
        }

        p  {
          font-size: 16px;
          margin-bottom: 5px;
          margin-top: 5px;
        }
        .strong {
          font-weight: bold;
        }
        .right {
          padding-left: 30px;
        }

      </style>

      <dom-bind>
        <iron-input  id="input1" bind-value="{{user}}">
          <input type="text" value="{{user::input}}">
        </iron-input>
        <iron-icon icon="search" on-click="_fire" ></iron-icon>
        <p class= "bold"> Total number of [[user]] 's Github repositories: [[numberRepos]]</p>
      </dom-bind>

      <template is="dom-repeat" items="[[repos]]">
          <div  class="card">
               <p class="strong"> Name: {{item.name}} </p>
               <p class="right"> Description: {{item.description}} </p>
               <p class="right"><i> Url: {{item.git_url}}</i> </p>
               <p class="right"> Created at: {{item.created_at}}   </p>
          </div>
      </template>


        <!-- url="https://api.github.com/users/burczu/repos" -->
        <!--
        If verbode true, error messages will automatically
        be logged to the console.


        With auto set to true, the element performs a request whenever its url,
        params or body properties are changed.

        headers='{"X-Requested-With": "XMLHttpRequest"}'
        on-response="_handleResponse"
        last-response= {{ajaxResponse}}
        -->
      <iron-ajax
            verbose
            id="requestRepos"
            url="[[url]]"
            params='{"type":"all"}'
            handle-as="json"
            on-response="_handleResponse"
            lastError = "{{lastError}}"
            on-error = "_handleError"
            iron-ajax-error = "_handleError"
            debounce-duration="300">
      </iron-ajax>
    </template>

    <script>
    class ShowGitRepositories extends Polymer.Element {
        static get is()  { return 'show-git-repositories' }
        static get properties() {
          return {
            repos: {
              type: Array,
              value: [],
              reflectToAttribute: true
            },

            user: {
              type: String,
              value: "PaulMatencio",
              notify: true,
              reflectToAttribute: true,
              observer: "_notify"
            },

            url: {
              type: String,
              value: function() {
                return ("https://api.github.com/users/" + this.user + "/repos")
              },
              reflectToAttribute: true
            },

            numberRepos: {
              type: Number,
              computed : '_computedLength(repos)',
              reflectToAttribute: true
            }
          }
        }

        constructor() {
          super();
        }

        ready() {
          super.ready();
          /**
           * You can trigger a request explicitly by calling generateRequest on the element.
           */
          this.$.requestRepos.generateRequest();
        }

        _handleResponse(event)  {
            const req = event.detail; // iron-request
            console.log('status', req.status, req.statusText);
            this.repos = event.detail.response;
        }

        _handleErrort(request, erorr)  {
          console.log(request,error);
        }

        _notify() {
            /* this.setProperties({url: 'xxxxxxx', user: xxxx }); */
            this.url =  "https://api.github.com/users/" + this.user + "/repos";
        }

        _fire() {
            this.repos = [];
            this.$.requestRepos.generateRequest();
        }

        _click() {
           console.log(this.$);
        }

        _computedLength(repos) {
          return repos.length ;
        }
      }

      // Register custom element definition using standard platform API
      customElements.define(ShowGitRepositories.is, ShowGitRepositories);
    </script>

</dom-module>
